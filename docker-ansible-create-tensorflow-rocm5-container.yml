---
- name: Launch a Tensorflow - ROCm5 Service Using Docker
  hosts: docker-nodes
  tasks:
  - name:
    docker_container:
      name: tensorflow
      state: started
      restart: true
      image: "{{ docker_image }}"
      network_mode: host
      devices:
        - "/dev/kfd"
        - "/dev/dri"
      ipc_mode: host
      shm_size: 16G
      groups:
        - video
      capabilities:
        - SYS_PTRACE
      security_opts:
        - seccomp=unconfined
      volumes:
        - /tmp/dockerx:/dockerx
